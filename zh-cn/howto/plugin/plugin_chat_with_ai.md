# 使用与 AI 聊天插件

## 安装
**与 AI 聊天** 作为 **ChatAI** 插件提供。您可以从 [ChatAI 插件下载页面](https://www.emeditor.com/download-chatai/)下载。**ChatAI** 插件不适用于 Microsoft 商店应用版。

### 桌面版
1. 如果您使用 EmEditor 的**桌面安装程序**版本，请点击 **Installer** 下载安装程序版本。
2. 运行已下载的安装程序。
3. 打开 EmEditor，依次转到**自定义** > **AI 选项**。勾选**启用 AI**。

### 便携版
1. 如果您使用 EmEditor 的**便携版**，请点击 **Zip archive** 下载 zip 文件。
2. 将 `ChatAI.dll` 解压到 EmEditor 文件夹中的 `PlugIns` 文件夹。
3. 在 EmEditor 中导航到[**自定义插件**](../../cmd/tools/customize_plug_ins)，并**添加**`ChatAI.dll` 文件。
4. 打开 EmEditor，前往到**自定义** > **AI 选项**。勾选**启用 AI**。

## API 密钥
要开始使用与 AI 聊天，请从以下 AI 提供商中创建并复制一个 API 密钥。

### Deepseek
1. 登录您的 Deepseek 账号并访问 [API 密钥页面](https://platform.deepseek.com/api_keys)。
2. 点击**创建新 API 密钥**，为密钥添加名称。
3. 复制 API 密钥。

### Google
1. 登录您的 Google AI Studio 帐户，并访问 [API 密钥页面](https://aistudio.google.com/u/1/apikey)。
2. 点击 **+ 创建 API 密钥**。
3. 如果出现提示，请选择一个现有的 Google Cloud 项目以创建 API 密钥。
4. 复制 API 密钥。

### OpenAI
1. 登录您的 OpenAI 账号并访问 [API 密钥页面](https://platform.openai.com/api-keys)。
2. 点击 **Create a new secret key**。或者，您也可以添加名称并选择一个项目。
3. 选择 **All** 权限，或选择 **Restricted** 并添加下方所需权限。随着新功能的增加，所需资源可能会有所变化：
   - **Model capabilities**：**Write**
   - **Responses API**：**Write**
   - 其他所有资源：**None**
4. 复制生成的 API 密钥。

## 安装
1. 安装 **ChatAI** 后，主菜单中应出现 **AI** 菜单。打开 **AI** 菜单并选择 **与 AI 聊天**。
2. 在 **与 AI 聊天** 应用中，点击侧边栏的 ⚙️ 按钮并选择**设置**。
3. 选择您想要的**服务提供商**。
4. 将您的 API 密钥粘贴到**API 密钥**字段中。

## 聊天面板
- 在底部输入框中输入您的问题或提示，按回车或点击 **&#8593;** 发送。
- 您的消息会显示在右侧，AI 的回复会很快显示在下方。提示和回复会保留在对话中，以便上下文相关的回答。
- 将鼠标悬停在任意消息上，可以看到以下按钮：
  - **复制到剪贴板**：将消息复制到剪贴板
  - **复制到新文档**：打开一个新文档并插入文本
  - **编辑消息**：对消息进行修改
  - **重新生成回复**：基于相同提示请求新的回复。如果您想要不同的表达方式时很有用。
- 点击 **⋯** 按钮或右键点击任意消息可获得更多选项：
  - **复制到编辑器**：将文本插入到编辑器的光标位置
  - **消息信息**：显示该消息的详细信息
- 代码块包含编程代码。在代码块中，您可以点击 **⋯** 以选择复制代码等选项。

## 聊天输入
* 在聊天面板底部的输入框中输入您的提示词。
* 点击 **+ 文件** 上传文件。
  * 此功能仅在使用 OpenAI 时可用。只能上传具有[受支持扩展名](https://platform.openai.com/docs/guides/tools-file-search#supported-files)的文件。
  * 当在编辑器中打开受支持的文件时，其文档名称会显示在文件选择下拉列表中。
  * 您也可以点击**浏览**，通过文件浏览对话框选择受支持的文件。
  * 上传文件后，“与 AI 聊天”会在 OpenAI 中同时创建文件资源和向量存储资源。之后即可在聊天对话中引用该文件。
  * 已上传的文件会列在输入区域中。点击文件可将其移除，或右键单击以查看更多选项。
  * 引用已上传文件通常比直接将文件内容复制粘贴到聊天中消耗更少的令牌。
  * 关于文件搜索费用的详细信息，请参阅 [OpenAI 价格](https://platform.openai.com/docs/pricing#built-in-tools)。
* 启用**工具**以使用工具调用功能。这些 EmEditor 工具可供 AI 用来读取或修改您的文档。
  * 工具仅对 OpenAI 和 DeepSeek 可用。
  * 将鼠标悬停在**工具**上并选择**设置**，以查看和配置可用工具。

## 侧边栏
- 对话会在侧边栏中列出。点击 **+ 新建聊天** 创建一个新的聊天，对话内容将彼此独立。该聊天中的回复只会使用该聊天中的上下文消息。
- 点击任意条目的 **&#8230;** 可选择以下操作：
  - **删除聊天**：清除该聊天中的所有消息
  - **复制到新文档**：将该会话中的所有消息复制到新文档
- 您可以通过点击**关闭侧边栏**按钮隐藏侧边栏。

## 搜索
* 点击侧边栏中的 🔍 按钮以搜索聊天消息。
* 在搜索框中输入关键词以显示匹配的消息。
* 在结果列表中选择一条消息，即可直接跳转到聊天面板中的对应位置。

## 设置
- 您可以通过点击侧边栏的 ⚙️ 按钮并选择**设置**来更改 AI 连接和用户界面设置。
- **AI 连接**
  - 配置应用如何连接到 AI 服务。
  - 您可以选择以下提供商：Deepseek、LM Studio/OpenAI 兼容、OpenAI
  - 点击**测试连接**，应用会通过发送一个小的 AI 请求来检查设置是否正确。
- **AI 参数**
  - 调整 AI 生成的相关参数。
  - 支持聊天补全和推理模型。
  - 详细设置请参考各提供商的文档：
    - [Deepseek](https://api-docs.deepseek.com/api/create-chat-completion)
    - [Google](https://ai.google.dev/api/generate-content)
    - [OpenAI](https://platform.openai.com/docs/api-reference/chat/create)
- **工具调用**
  - 这些 EmEditor 工具可供 AI 访问，以读取或修改您的文档。
  - 使用工具会产生额外的令牌费用。
  - 通过单击**工具**按钮，可以在聊天输入框中启用工具调用。
- **文件**
  - 这些用于 OpenAI 文件搜索功能的选项用于控制文件和向量存储的过期时间。
- **用户界面**
  - 这些设置可自定义与 AI 聊天的界面。
- **调试日志选项**
  - 调试日志有助于诊断应用的技术问题。
- **更新**
  - 允许您手动更新应用。
- **重置设置**
  - 删除所有聊天记录或将所有设置重置为默认值。

## 已上传的文件
* 要查看已上传的文件和向量存储，请点击侧边栏中的 ⚙️ 按钮，并选择 **已上传的文件**。
* 该对话框会显示与您的 OpenAI 账户或组织关联的所有文件和向量存储。对于每个向量存储，还会显示其关联的聊天以及当前状态。
  * 已过期的向量存储不会产生存储费用。
* 您可以从您的账户或组织中选择并删除文件或向量存储。

## LM Studio 设置说明
集成 LM Studio 需要进行初始设置。请按照以下步骤设置 LM Studio。

1. 从 [lmstudio.ai](https://lmstudio.ai/) 下载并安装 LM Studio。
2. 在 LM Studio 中，前往 **Discover** 标签页下载模型。
    - 推荐尝试 `mistralai/mistral-7b-instruct-v0.3` 模型，因为它可以在大多数电脑上运行。
    - 加载系统不支持的模型可能会导致错误。
3. 在 LM Studio 窗口顶部，加载您下载的模型。
4. 前往 **Developer** 标签页。点击左上角的开关以启动服务器，状态应显示为“Status: Running”。
5. 打开开关旁边的**设置**。**启用 CORS**。
6. 打开 **与 AI 聊天** 并进入**设置**。
7. 在 **AI 连接**页面，将**提供商**设置为“LM Studio/OpenAI 兼容”。**API 密钥**字段留空。
8. 前往 **AI 参数**页面。在**模型**下选择您下载的模型。
   - 如果未列出，请确认 LM Studio 已启用 CORS。您也可以选择“其他”手动输入模型名称。
9. 返回 **AI 连接**，点击**测试连接**以确保可以连接到 LM Studio。

- 每次重启电脑后，LM Studio 服务会自动启动。但在与 AI 聊天中使用前，您需要手动加载模型。