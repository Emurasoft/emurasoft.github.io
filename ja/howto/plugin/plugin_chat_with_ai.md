# [AI とチャット] プラグインの使い方

## インストール
**AI とチャット** は **ChatAI** プラグインとして提供されています。[ChatAI プラグイン ダウンロード](https://jp.emeditor.com/download-chatai/) からダウンロードできます。**ChatAI** プラグインは、ストア アプリ版ではご利用いただけません。

### デスクトップ
1. EmEditor の **デスクトップ インストーラー版** を使用している場合は、**インストーラー** をクリックしてインストーラー版をダウンロードします。
2. ダウンロードしたインストーラーを実行します。
3. EmEditor を開き、**カスタマイズ** > **AI オプション** に移動します。**AI を有効にする** にチェックを入れます。

### ポータブル
1. EmEditor の **ポータブル版** を使用している場合は、**zipアーカイブ** をクリックして zip ファイルをダウンロードします。
2. `ChatAI.dll` ファイルを、EmEditor フォルダー内の `PlugIns` フォルダーに解凍（展開）します。
3. EmEditor で [**プラグインのカスタマイズ**](../../cmd/tools/customize_plug_ins) に移動し、`ChatAI.dll` ファイルを **追加** します。
4. EmEditor を開き、**カスタマイズ** > **AI オプション** に移動します。**AI を有効にする** にチェックを入れます。

## APIキー
AIとチャットを利用するには、以下のいずれかのAIプロバイダーからAPIキーを作成し、コピーしてください。

### Deepseek
1. Deepseekアカウントにログインし、[APIキーのページ](https://platform.deepseek.com/api_keys)にアクセスします。
2. **Create new API key** をクリックし、キーの名前を入力します。
3. APIキーをコピーします。

### Google
1. Google AI Studio アカウントにログインし、[API キーのページ](https://aistudio.google.com/u/1/apikey)にアクセスします。
2. **+ Create API Key** をクリックします。
3. プロンプトが表示されたら、API キーを作成するために既存の Google Cloud プロジェクトを選択します。
4. API キーをコピーします。

### OpenAI
1. OpenAIアカウントにログインし、[APIキーページ](https://platform.openai.com/api-keys)にアクセスします。
2. **Create a new secret key** をクリックします。必要に応じて名前を追加し、プロジェクトを選択できます。
3. **All** 権限を選択するか、**Restricted** を選択して下記の必要な権限を追加します。新機能の追加により必要なリソースは今後変更される場合があります。
   - **Model capabilities**: **Write**
   - **Responses API**: **Write**
   - その他のリソース: **None**
4. 生成されたAPIキーをコピーします。

## セットアップ
1. [ChatAI] プラグインをインストールすると、メインメニューに [AI] メニューが表示されます。[AI] メニューを開き、[AIとチャット] を選択します。
2. **AIとチャット** アプリで、サイドバーの ⚙️ ボタンをクリックし、**設定** を選択します。
3. お好みの**プロバイダー**を選択してください。
3. **APIキー**欄にAPIキーを貼り付けます。

## チャットパネル
- 下部の入力ボックスに質問やプロンプトを入力し、Enterキーを押すか **&#8593;** をクリックして送信します。
- 送信したメッセージは右側に表示され、AIのレスポンスがすぐ下に表示されます。プロンプトとレスポンスは会話内に残り、文脈を考慮した返信が可能です。
- メッセージにカーソルを合わせると、以下のボタンが表示されます。
  - **クリップボードにコピー**: メッセージをクリップボードにコピーします
  - **新規文書にコピー**：新しい文書を開き、テキストを挿入します
  - **メッセージを編集**: メッセージを修正します
  - **レスポンスを再生成**: 同じプロンプトで新しいレスポンスをリクエストします。異なる表現が欲しい場合に便利です。
- **⋯** ボタンをクリックするか、メッセージを右クリックすると追加オプションが表示されます。
  - **エディターにコピー**: エディターのカーソル位置にテキストを挿入します
  - **メッセージ情報**：このメッセージの詳細を表示します
- コード ブロックにはプログラム コードが含まれています。コード ブロック内では **⋯** をクリックしてコードをコピーするオプションが利用できます。

## チャット入力
* チャットパネル下部の入力欄にプロンプトを入力します。
* **+ ファイル** をクリックしてファイルをアップロードします。
  * この機能は OpenAI を使用している場合にのみ利用できます。アップロードできるのは、[対応する拡張子](https://platform.openai.com/docs/guides/tools-file-search#supported-files) のファイルのみです。
  * 対応ファイルをエディターで開くと、ドキュメント名がファイル選択ドロップダウンに表示されます。
  * **参照** をクリックして、ファイル選択ダイアログから対応ファイルを選ぶこともできます。
  * ファイルをアップロードすると、AI とのチャットは OpenAI 上に「ファイル」および「ベクターストア」のリソースを作成します。その後、そのファイルはチャット中の会話で参照できます。
  * アップロードしたファイルは入力エリアに一覧表示されます。削除するにはファイルをクリックし、追加オプションを表示するには右クリックします。
  * アップロードしたファイルを参照するほうが、ファイル内容を直接コピー＆ペーストするよりも、通常は消費トークン数が少なくなります。
  * ファイル検索のコストの詳細は、[OpenAI 料金](https://platform.openai.com/docs/pricing#built-in-tools) を参照してください。
* **ツール** を有効にすると、ツール呼び出し機能を使用できます。これらの EmEditor ツールを AI が利用して、ドキュメントの読み取りや変更を行えます。
  * ツールは OpenAI と DeepSeek でのみ利用できます。
  * **ツール** にカーソルを合わせて **設定** を選択すると、利用可能なツールの表示と設定ができます。

## サイドバー
- サイドバーには会話の一覧が表示されます。**+ チャットの新規作成** をクリックすると、別の会話を含む新しいチャットを作成できます。チャット内のレスポンスは、そのチャット内のメッセージの文脈のみを使用します。
- 各エントリの **&#8230;** をクリックすると、以下のオプションが表示されます。
  - **チャットを削除**: そのチャット内のすべてのメッセージを消去します
  - **新規文書にコピー**: 会話内のすべてのメッセージを新しいドキュメントにコピーします
- **サイドバーを閉じる** ボタンでサイドバーを非表示にできます。

## 検索
* サイドバーの🔍ボタンをクリックして、チャット メッセージを検索します。  
* 検索ボックスにキーワードを入力すると、一致するメッセージが表示されます。  
* 結果一覧からメッセージを選択すると、チャットパネル内の該当箇所へ直接移動できます。

## 設定
- サイドバーの ⚙️ ボタンをクリックし、**設定** を選択すると、AI接続やユーザーインターフェイスの設定を変更できます。
- **AI接続**
  - アプリがAIサービスに接続する方法を設定します。
  - Deepseek、LM Studio/OpenAI互換、OpenAI からプロバイダーを選択できます。
  - **接続テスト** をクリックすると、プロバイダーに小さなAIリクエストを送信して設定が正しいか確認します。
- **AIパラメーター**
  - AI生成のパラメーターを調整できます。
  - チャット補完や推論モデルに対応しています。
  - 各設定の詳細はプロバイダーのドキュメントを参照してください。
    - [Deepseek](https://api-docs.deepseek.com/api/create-chat-completion)
    - [Google](https://ai.google.dev/api/generate-content)
    - [OpenAI](https://platform.openai.com/docs/api-reference/chat/create)
- **ツール呼び出し**
  - これらの EmEditor のツールを AI が利用できるようにし、文書を読み取ったり変更したりできます。
  - ツールを使用すると、追加のトークン コストが発生します。
  - チャット入力から [ツール] ボタンをクリックして、ツール呼び出しを有効にできます。
- **ファイル**
  - OpenAI のファイル検索機能に関するこれらのオプションは、ファイルおよびベクターストアの有効期限を制御します。
- **ユーザー インターフェイス**
  - AIとチャットのインターフェイスをカスタマイズできます。
- **デバッグ ログ オプション**
  - デバッグ ログはアプリの技術的な問題の診断に役立ちます。
- **更新**
  - アプリを手動で更新できるようにします。
- **設定をリセット**
  - すべてのチャットを削除するか、すべての設定を初期設定にリセットします。

## アップロードされたファイル
* アップロード済みファイルとベクターストアを表示するには、サイドバーの ⚙️ ボタンをクリックし、\[アップロードされたファイル\] を選択します。
* ダイアログには、あなたの OpenAI アカウントまたは組織に紐づくすべてのファイルとベクターストアが表示されます。各ベクターストアについて、関連するチャットと現在のステータスも表示されます。
  * 期限切れのベクターストアにはストレージ料金は発生しません。
* アカウントまたは組織から、ファイルまたはベクターストアを選択して削除できます。

## LM Studio セットアップ手順
LM Studio との連携には初期設定が必要です。以下の手順に従ってセットアップしてください。

1. [lmstudio.ai](https://lmstudio.ai/) から LM Studio をダウンロードしてインストールします。
2. LM Studio で **Discover** タブに移動し、モデルをダウンロードします。
    - `mistralai/mistral-7b-instruct-v0.3` は多くのPCで動作するおすすめのモデルです。
    - システムが対応していないモデルを読み込もうとするとエラーになる場合があります。
3. LM Studioウィンドウの上部で、ダウンロードしたモデルを読み込みます。
4. **Developer**タブに移動します。左上のスイッチをクリックしてサーバーを起動します。「Status: Running」と表示されていれば正常です。
5. スイッチの隣にある**Settings**を開きます。**CORSを有効化**してください。
6. **AIとチャット**を開き、**設定**を開きます。
7. **AI接続**ページで、**プロバイダー**を「LM Studio/OpenAI互換」に設定します。**APIキー**の欄は空欄のままにしてください。
8. **AIパラメータ**ページに移動します。**モデル**の項目で、ダウンロードしたモデルを選択します。
   - リストに表示されない場合は、LM StudioでCORSが有効になっているか確認してください。「Other」を選んでモデル名を手動で入力することもできます。
9. **AI接続**に戻り、**Test Connection**をクリックしてLM Studioに接続できるか確認します。

- コンピューターを再起動するたびにLM Studioのサービスは自動的に起動しますが、「AIとチャット」で使用する前にモデルを手動で読み込む必要があります。
